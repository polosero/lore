<div *ngIf="document!=null">
    <div class="header-bar">
        <div class="title">
            <h1 (click)="editName()" *ngIf="showName">{{document.name}}</h1>
            <div *ngIf="!showName">
                <input [(ngModel)]="document.name">
                <material-button icon (trigger)="deselect()">
                    <material-icon icon="done" size="small"></material-icon>
                </material-button>
            </div>
        </div>
        <div class="lock-duration" *ngIf="editMode&&lockDuration!=null">
            <div *ngIf="lockDuration.isNegative">
                <h2>Your lock has run out. Please try to extend your lock.</h2>
            </div>
            <div *ngIf="!lockDuration.isNegative">
                <h2>Your lock will expire in: {{lockDuration | time}}</h2>
            </div>
        </div>
    </div>
    <div class="scrollable">
        <snippet-comp *ngFor="let snippet of document.snippets;let f=first;let l=last" [snippet]="snippet" [first]="f"
                      [last]="l" [showMetadata]="showMetadata" [allowEdit]="editMode" [selected]="selected === snippet"
                      (selectMe)="selectSnippet($event)" (removeMe)="removeSnippetDialog($event)"></snippet-comp>
    </div>
</div>
<div class="toolbar">
    <div *ngIf="!editMode">
        <material-button raised (click)="back()">
            Back
            <material-icon icon="reply_all" size="large"></material-icon>
        </material-button>
        <material-button raised (click)="startEdit()">
            Edit
            <material-icon icon="edit" size="large"></material-icon>
        </material-button>
    </div>

    <div *ngIf="editMode">
        <material-button raised (click)="addNewSnippet()">
            Add new snippet
            <material-icon icon="add_comment" size="large"></material-icon>
        </material-button>

        <material-button raised (click)="stopEdit()">
            Stop Editing
            <material-icon icon="lock_open" size="large"></material-icon>
        </material-button>

        <material-button raised (click)="saveChanges()" [disabled]="lockDuration==null||lockDuration.isNegative">
            SaveChanges
            <material-icon icon="save" size="large"></material-icon>
        </material-button>

        <material-button raised (click)="showDeleteDocumentDialog=true" [disabled]="lockDuration==null||lockDuration.isNegative">
            Delete document
            <material-icon icon="delete_forever" size="large"></material-icon>
        </material-button>

        <material-button raised (click)="extendLock()">
            Extend Lock
            <material-icon icon="lock" size="large"></material-icon>
        </material-button>
    </div>

    <div>
        <material-button raised *ngIf="!showMetadata" (click)="showMetadata=true">
            Show Metadata
            <material-icon icon="visibility" size="large"></material-icon>
        </material-button>
        <material-button raised *ngIf="showMetadata" (click)="showMetadata=false">
            Hide Metadata
            <material-icon icon="visibility_off" size="large"></material-icon>
        </material-button>
    </div>
</div>






<modal [visible]="showSaveChangesDialog" headered>
    <material-dialog class="basic-dialog" [autoDismissable]="showSaveChangesDialog"
                     (dismiss)="showSaveChangesDialog=false">
        <div header><h1>Do you wish to save changes</h1></div>

        <div footer>
            <material-button clear-size (trigger)="saveChangesAndStopEdit()" [disabled]="lockDuration==null||lockDuration.isNegative">
                Save Changes And Stop Editing
                <material-icon icon="save" size="large"></material-icon>
            </material-button>

            <material-button clear-size (trigger)="trashChangesAndStopEdit()">
                Trash Changes And Stop Editing
                <material-icon icon="delete_forever" size="large"></material-icon>
            </material-button>

            <material-button clear-size (trigger)="showSaveChangesDialog=false">
                Cancel
                <material-icon icon="clear" size="large"></material-icon>
            </material-button>
        </div>
    </material-dialog>
</modal>

<modal [visible]="showRemoveSnippetDialog" headered>
    <material-dialog class="basic-dialog" [autoDismissable]="showRemoveSnippetDialog"
                     (dismiss)="showRemoveSnippetDialog=false">
        <div header><h1>Do you really wish to remove snippet?</h1></div>

        <div footer>
            <material-button clear-size (trigger)="removeSnippet()">
                Remove Snippet
                <material-icon icon="delete_forever" size="large"></material-icon>
            </material-button>

            <material-button clear-size (trigger)="showRemoveSnippetDialog=false">
                Cancel
                <material-icon icon="clear" size="large"></material-icon>
            </material-button>
        </div>
    </material-dialog>
</modal>

<modal [visible]="showDeleteDocumentDialog" headered>
    <material-dialog class="basic-dialog" [autoDismissable]="showDeleteDocumentDialog"
                     (dismiss)="showDeleteDocumentDialog=false">
        <div header><h1>Do you really wish to delete this snippet?</h1></div>

        <div footer>
            <material-button clear-size (trigger)="removeDocument()" [disabled]="lockDuration==null||lockDuration.isNegative">
                Delete Document
                <material-icon icon="delete_forever" size="large"></material-icon>
            </material-button>

            <material-button clear-size (trigger)="showDeleteDocumentDialog=false">
                Cancel
                <material-icon icon="clear" size="large"></material-icon>
            </material-button>
        </div>
    </material-dialog>
</modal>

<modal [visible]="showCannotEditDialog1">
    <material-dialog headered class="basic-dialog" [autoDismissable]="showCannotEditDialog1"
                     (dismiss)="showCannotEditDialog1=false">
        <div header><h1>Edit Error</h1></div>
        <p style="color: red">
            We are sorry. But you cannot edit this document because someone else is already editing it. Try it again later.
        </p>
        <div footer>
            <material-button clear-size (trigger)="showCannotEditDialog1=false">
                <material-icon icon="clear" size="large"></material-icon>
            </material-button>
        </div>
    </material-dialog>
</modal>

<modal [visible]="showCannotEditDialog2">
    <material-dialog headered class="basic-dialog" [autoDismissable]="showCannotEditDialog2"
                     (dismiss)="showCannotEditDialog2=false">
        <div header><h1>Edit Error</h1></div>
        <p style="color: red">
            We are sorry, but during the time you haven't held this document's lock somebody else edited it. For that
            reason we cannot allow you to save your current changes. Save your changes to text document and then click
            <i>Stop Editing -> Trash Changes And Stop Editing</i>. After that you will be able to edit this document again.
        </p>
        <div footer>
            <material-button clear-size (trigger)="showCannotEditDialog2=false">
                <material-icon icon="clear" size="large"></material-icon>
            </material-button>
        </div>
    </material-dialog>
</modal>


<modal [visible]="showRenameUnsuccessfulDialog">
    <material-dialog headered class="basic-dialog" [autoDismissable]="showRenameUnsuccessfulDialog"
                     (dismiss)="showRenameUnsuccessfulDialog=false">
        <div header><h1>Rename Error</h1></div>
        <p style="color: red">
            We are sorry. But we were unable to rename the document, because the new name is not unique.
        </p>
        <div footer>
            <material-button clear-size (trigger)="showRenameUnsuccessfulDialog=false">
                <material-icon icon="clear" size="large"></material-icon>
            </material-button>
        </div>
    </material-dialog>
</modal>